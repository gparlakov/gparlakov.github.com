import{b as d,h,m as S,z as m,_ as u,e as g,A as w,C as P,v as x,r as O,U as a,P as s,N as l,O as y,w as A,K as p,a as M}from"./q-29eba519.js";import{a as j,d as E,M as I,m as R}from"./q-caaebdfa.js";import{M as T}from"./q-127ed3db.js";import{M as D}from"./q-a87c78bd.js";import{M as C}from"./q-1f2398e8.js";import{R as L,g as $}from"./q-a6c27b82.js";import{_auto_useTabStorage as V}from"./q-0c488c37.js";import"./q-38c94a1c.js";const q=()=>{const[e,t]=d();e.filter.categories=[j],e.next=h(()=>{t("next")}),e.previous=h(()=>t("previous"))},K=S(m(()=>u(()=>import("./q-042cf64f.js"),["build/q-042cf64f.js","build/q-29eba519.js","build/q-caaebdfa.js","build/q-38c94a1c.js"]),"s_SpRqGhunbOQ")),U=()=>{g(),w(m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_HBSUmw5O6JI"));const e=P({movements:h([]),maxSum:0,months:[],allCategories:h([]),filter:{categories:[]}}),t=V("chart"),n=x(m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_Uw4X0WX0Hq8",[e]));return O(m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_snw0TywByhA",[e,m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_Mipy08BPYpw",[e])])),a(p,{children:[a(K,{store:e,[s]:{store:s}},3,"jl_0"),l("header",null,{class:"navbar"},[l("div",null,{class:"navbar-start"},l("div",null,{class:"join"},[l("button",null,{class:y(r=>`join-item  hide-text  btn btn-sm ${r.value==="chart"?"btn-accent ":""}`,[t]),onClick$:m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_y6nc4RA80e0",[t])},["📊 ",l("span",null,{class:"hidden-text"},"chart",3,null)],3,null),l("button",null,{class:y(r=>`join-item  hide-text btn btn-sm ${r.value==="grid"?"btn-accent":""}`,[t]),onClick$:m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_0z0I2qK50qE",[t])},["📑 ",l("span",null,{class:"hidden-text"},"grid",3,null)],3,null),l("button",null,{class:"join-item hide-text  btn btn-sm",title:"reload",onClick$:m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_KnrMHaqUdrw",[e])},[" 🔁 ",l("span",null,{class:"hidden-text"},"reload",3,null)],3,null)],3,null),3,null),l("div",null,{class:"navbar-center"},a(D,{filterStore:e,[s]:{filterStore:s}},3,"jl_1"),1,null)],1,null),t.value==="chart"?a(A,{value:n,onResolved:({errors:r})=>(g(),Array.isArray(r)?a(p,{children:r.map((_,v)=>l("span",null,null,JSON.stringify(_),1,`error-index-key-${v}`))},1,"jl_2"):a(p,{children:[a(L,{movementDetailsStore:e,[s]:{movementDetailsStore:s}},3,"jl_3"),a(T,{store:e,[s]:{store:s}},3,"jl_4")]},1,"jl_5")),onPending:()=>a(p,{children:"Loading..."},3,"jl_6"),onRejected:r=>a(p,{children:["Could not load movements. Error follows (if any): ",l("hr",null,null,null,3,null)," ",JSON.stringify(r)]},1,"jl_7"),[s]:{value:s,onResolved:s,onPending:s,onRejected:s}},3,"jl_8"):a(C,{appStore:e,[s]:{appStore:s}},3,"jl_9")]},1,"jl_10")},N=`.debit,.credit{font-size:.6rem}.hover{position:fixed;display:none;background-color:#fff;border:1px solid gray}.hover .show{display:initial}rect.focused{fill:"aliceblue";transition:cubic-bezier(.165,.84,.44,1)}.hide-text .hidden-text{display:none}.hide-text:hover .hidden-text{display:inline}@keyframes slide{0%{display:none}to{display:inline}}
`,z=N,H=e=>{const[t]=d();if(t.movements&&t.selectedId){const n=t.movements.findIndex(r=>r.id===t.selectedId);let i=e==="next"?n+1:n-1;i>=t.movements.length-1?i=0:i<=0&&(i=t.movements.length-1),t.selectedId=t.movements[i].id}},k=()=>{const[e]=d();return e.value="grid"};function B(e,t=500){let n;return(...i)=>new Promise(r=>{n&&clearTimeout(n),n=setTimeout(()=>{r(e(...i))},t)})}const J=300,W=B(E,J);function X(e){return Array.isArray(e)?e.map(t=>t.amount).reduce((t,n)=>t+n,0):0}function F({data:e,errors:t}){const n=e?.movements?.movements?.map(o=>{const f=new Date(Number(o.date));return{amount:Number(o.amount),description:o.description??"",type:o.type===I.Credit?"Credit":"Debit",date:f,id:o.id,categories:o.categories?.filter(b=>b!=null).map(b=>({name:b.name}))??[],month:`${f.getMonth()+1}-${f.getFullYear()}`}})??[],_=[...$(n,o=>o.month,o=>o.type).values()].flatMap(o=>[...o.values()]).map(X),v=R(_)??25e3;return{errors:t?.map(o=>typeof o=="string"?o:JSON.stringify(o)),movements:n,maxSum:v,months:[...new Set(n.map(o=>o.month))]}}const G=async({track:e,cleanup:t})=>{const[n]=d();e(n.filter);const i=new AbortController;return t(()=>i.abort()),W(n.filter,{field:"date",desc:!0}).then(F).then(({errors:r,maxSum:_,months:v,movements:o})=>(n.movements=h(o),n.maxSum=_,n.months=v,{errors:r}))},Y=()=>{const[e]=d();return e.filter.categories=[...e.filter.categories]},Q=()=>{const[e]=d();return e.value="chart"},c=Object.freeze(Object.defineProperty({__proto__:null,_hW:M,s_0z0I2qK50qE:k,s_HBSUmw5O6JI:z,s_HufueK3X2Go:U,s_KnrMHaqUdrw:Y,s_Mipy08BPYpw:H,s_Uw4X0WX0Hq8:G,s_snw0TywByhA:q,s_y6nc4RA80e0:Q},Symbol.toStringTag,{value:"Module"}));export{M as _hW,k as s_0z0I2qK50qE,z as s_HBSUmw5O6JI,U as s_HufueK3X2Go,Y as s_KnrMHaqUdrw,H as s_Mipy08BPYpw,G as s_Uw4X0WX0Hq8,q as s_snw0TywByhA,Q as s_y6nc4RA80e0};
