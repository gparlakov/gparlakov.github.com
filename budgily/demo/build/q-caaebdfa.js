import"./q-38c94a1c.js";let F;(function(e){e.Credit="CREDIT",e.Debit="DEBIT"})(F||(F={}));const D="budgily-categories-filter-value-all",E="budgily-categories-filter-value-no-category",I=new Date("Invalid dddate").toString();function V(e){return e!=null&&new Date(e).toString()!=I}function J(e,a){let i;if(a===void 0)for(const u of e)u!=null&&(i<u||i===void 0&&u>=u)&&(i=u);else{let u=-1;for(let f of e)(f=a(f,++u,e))!=null&&(i<f||i===void 0&&f>=f)&&(i=f)}return i}const T=new Date("invalid").toString();function S(e){return e!=null&&typeof e=="object"&&"getUTCDate"in e&&e.toString()!=T}const O="all-movements",B="/mock-data.json",x="all-categories";function K({from:e,categories:a,to:i,search:u,amountMin:f,amountMax:d,id:g}={},{field:o,desc:N}={},{page:C,size:p}={}){return Promise.resolve().then(()=>{const c=window.localStorage.getItem(O);return typeof c=="string"&&c.length>0?JSON.parse(c):fetch(B).then(t=>t.json()).then(t=>(window.localStorage.setItem(O,JSON.stringify(t)),t))}).then(c=>c.map(t=>({...t,date:new Date(t.date)}))).then(c=>{const t=()=>!0,m=Array.isArray(g)?l=>g.includes(l.id):t,w=typeof f=="number"&&f>0?l=>l.amount>=f:t,n=typeof d=="number"&&d>0?l=>l.amount<=d:t;let r=t;if(e!=null&&S(e)){const l=e.valueOf();r=s=>s.date!=null&&s.date.valueOf()>l}let h=t;if(i!=null&&S(i)){const l=i.valueOf();h=s=>s.date!=null&&s.date.valueOf()<l}let v=t;if(typeof u=="string"){const l=new RegExp(u,"i");v=s=>s!=null&&l.test(`${s.amount} ${s.type} ${s.description}`)}let b=t;if(Array.isArray(a)&&a.filter(l=>l!=D).length>0){const l=a.includes(D),s=a.includes(E),A=a.filter(y=>y!=D&&y!=E),j=A.length>0;b=y=>l||s&&(y.categories==null||y.categories.length===0)||j&&y.categories?.some($=>A.includes($.id.toString()))}return c.filter(m).filter(w).filter(n).filter(b).filter(r).filter(h).filter(v)}).then(c=>{let t;const m=["description","type"];return(n=>typeof n=="string"&&m.some(r=>r===n))(o)&&(t=(n,r)=>n[o]==null?r[o]==null?0:-1:n[o].localeCompare(r[o])),o==="amount"&&(t=(n,r)=>n.amount==null?r.amount==null?0:-1:n.amount-r.amount),o==="date"&&(t=(n,r)=>S(n.date)?Number(n.date)-Number(r.date):S(r.date)?-1:0),t!=null&&typeof t=="function"?c.sort((n,r)=>N?t(r,n):t(n,r)):c}).then(c=>Promise.all([c,P()])).then(([c,t])=>{const m=c.length??0,w=Number(C)-1<0?0:Number(C)-1,n=p!=null&&Number(p)>0&&Number(p)<m?Number(p):m,r=m>0&&p!=null&&p*w<m?w+1:1,h=n*r<m?n:m-n*(r-1),v=(r-1)*n,b=v+h+1;return{data:{movements:{movements:c.slice(v,b).map(l=>({...l,categories:l.categories=t.filter(s=>(s.movementIds??[]).includes(l.id)).map(s=>({id:s.id,name:s.name}))})),sort:{field:o??"date",desc:N},page:{currentPage:r,pageCount:n,totalCount:m,count:h}}}}})}function P(){return Promise.resolve().then(()=>{const e=window.localStorage.getItem(x);return typeof e=="string"?JSON.parse(e):[]})}function L(e){return K({id:Array.isArray(e)?e:[e]}).then(a=>a.data?.movements?.movements??[])}function M({category:e,categoryId:a,movementIds:i}){if(!Array.isArray(i))throw new Error(`Expected an array of movements but got ${i}`);if(typeof e=="object"&&e==null)throw new Error("Expected a category but got empty (null|undefined)");if(typeof e=="object"&&e?.name==null)throw new Error("Can not create a category without a name");return P().then(u=>{if(typeof a=="number"&&u.find(o=>o.id===a)==null)throw new Error(`Could not find category with id ${a}. Please create a new one or provide a correct category id`);const f=typeof e=="object"&&Array.isArray(i)&&e?.name!=null;let d=a,g;return f?(d=(J(u.map(o=>o.id))??0)+1,g=[...u,{...e,id:d,movementIds:[...new Set([...i,...i])]}]):(d=a,g=u.map(o=>o.id===a?{...o,movementIds:[...new Set([...o.movementIds??[],...i])]}:o)),window.localStorage.setItem(x,JSON.stringify(g)),g.find(o=>o.id===d)})}export{F as M,E as a,L as b,M as c,K as d,D as f,P as g,J as m,V as v};
