import{l as d,f as h,O as S,c as m,_ as u,b,o as w,N as x,i as E,E as O,h as a,v as s,$ as l,w as y,k as P,x as v,p as M}from"./q-0f391e12.js";import{a as j,d as A,M as I,m as R}from"./q-e6909596.js";import{M as T}from"./q-b5b92b78.js";import{M as D}from"./q-d6d88a69.js";import{M as C}from"./q-cf4c94b4.js";import{R as $,g as L}from"./q-851e9430.js";import{_auto_useTabStorage as V}from"./q-81199e23.js";import"./q-38c94a1c.js";const q=()=>{const[e,t]=d();e.filter.categories=[j],e.next=h(()=>{t("next")}),e.previous=h(()=>t("previous"))},N=S(m(()=>u(()=>import("./q-0d0f979c.js"),["build/q-0d0f979c.js","build/q-0f391e12.js","build/q-e6909596.js","build/q-38c94a1c.js"]),"s_SpRqGhunbOQ")),k=()=>{b(),w(m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_HBSUmw5O6JI"));const e=x({movements:h([]),maxSum:0,months:[],allCategories:h([]),filter:{categories:[]}}),t=V("chart"),n=E(m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_Uw4X0WX0Hq8",[e]));return O(m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_snw0TywByhA",[e,m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_Mipy08BPYpw",[e])])),a(v,{children:[a(N,{store:e,[s]:{store:s}},3,"jl_0"),l("header",null,{class:"navbar"},[l("div",null,{class:"navbar-start"},l("div",null,{class:"join"},[l("button",null,{class:y(r=>`join-item  hide-text  btn btn-sm ${r.value==="chart"?"btn-accent ":""}`,[t]),onClick$:m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_y6nc4RA80e0",[t])},["📊 ",l("span",null,{class:"hidden-text"},"chart",3,null)],3,null),l("button",null,{class:y(r=>`join-item  hide-text btn btn-sm ${r.value==="grid"?"btn-accent":""}`,[t]),onClick$:m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_0z0I2qK50qE",[t])},["📑 ",l("span",null,{class:"hidden-text"},"grid",3,null)],3,null),l("button",null,{class:"join-item hide-text  btn btn-sm",onClick$:m(()=>u(()=>Promise.resolve().then(()=>c),void 0),"s_KnrMHaqUdrw",[e]),title:"reload"},[" 🔁 ",l("span",null,{class:"hidden-text"},"reload",3,null)],3,null)],3,null),3,null),l("div",null,{class:"navbar-center"},a(D,{filterStore:e,[s]:{filterStore:s}},3,"jl_1"),1,null)],1,null),t.value==="chart"?a(P,{onPending:()=>a(v,{children:"Loading..."},3,"jl_6"),onRejected:r=>a(v,{children:["Could not load movements. Error follows (if any): ",l("hr",null,null,null,3,null)," ",JSON.stringify(r)]},1,"jl_7"),onResolved:({errors:r})=>(b(),Array.isArray(r)?a(v,{children:r.map((_,p)=>l("span",null,null,JSON.stringify(_),1,`error-index-key-${p}`))},1,"jl_2"):a(v,{children:[a($,{movementDetailsStore:e,[s]:{movementDetailsStore:s}},3,"jl_3"),a(T,{store:e,[s]:{store:s}},3,"jl_4")]},1,"jl_5")),value:n,[s]:{onPending:s,onRejected:s,onResolved:s,value:s}},3,"jl_8"):a(C,{appStore:e,[s]:{appStore:s}},3,"jl_9")]},1,"jl_10")},H=`.debit,.credit{font-size:.6rem}.hover{position:fixed;display:none;background-color:#fff;border:1px solid gray}.hover .show{display:initial}rect.focused{fill:"aliceblue";transition:cubic-bezier(.165,.84,.44,1)}.hide-text .hidden-text{display:none}.hide-text:hover .hidden-text{display:inline}@keyframes slide{0%{display:none}to{display:inline}}
`,B=H,K=e=>{const[t]=d();if(t.movements&&t.selectedId){const n=t.movements.findIndex(r=>r.id===t.selectedId);let i=e==="next"?n+1:n-1;i>=t.movements.length-1?i=0:i<=0&&(i=t.movements.length-1),t.selectedId=t.movements[i].id}},U=()=>{const[e]=d();return e.value="grid"};function z(e,t=500){let n;return(...i)=>new Promise(r=>{n&&clearTimeout(n),n=setTimeout(()=>{r(e(...i))},t)})}const J=300,W=z(A,J);function X(e){return Array.isArray(e)?e.map(t=>t.amount).reduce((t,n)=>t+n,0):0}function F({data:e,errors:t}){const n=e?.movements?.movements?.map(o=>{const f=new Date(Number(o.date));return{amount:Number(o.amount),description:o.description??"",type:o.type===I.Credit?"Credit":"Debit",date:f,id:o.id,categories:o.categories?.filter(g=>g!=null).map(g=>({name:g.name}))??[],month:`${f.getMonth()+1}-${f.getFullYear()}`}})??[],_=[...L(n,o=>o.month,o=>o.type).values()].flatMap(o=>[...o.values()]).map(X),p=R(_)??25e3;return{errors:t?.map(o=>typeof o=="string"?o:JSON.stringify(o)),movements:n,maxSum:p,months:[...new Set(n.map(o=>o.month))]}}const G=async({track:e,cleanup:t})=>{const[n]=d();e(n.filter);const i=new AbortController;return t(()=>i.abort()),W(n.filter,{field:"date",desc:!0}).then(F).then(({errors:r,maxSum:_,months:p,movements:o})=>(n.movements=h(o),n.maxSum=_,n.months=p,{errors:r}))},Y=()=>{const[e]=d();return e.filter.categories=[...e.filter.categories]},Q=()=>{const[e]=d();return e.value="chart"},c=Object.freeze(Object.defineProperty({__proto__:null,_hW:M,s_0z0I2qK50qE:U,s_HBSUmw5O6JI:B,s_HufueK3X2Go:k,s_KnrMHaqUdrw:Y,s_Mipy08BPYpw:K,s_Uw4X0WX0Hq8:G,s_snw0TywByhA:q,s_y6nc4RA80e0:Q},Symbol.toStringTag,{value:"Module"}));export{M as _hW,U as s_0z0I2qK50qE,B as s_HBSUmw5O6JI,k as s_HufueK3X2Go,Y as s_KnrMHaqUdrw,K as s_Mipy08BPYpw,G as s_Uw4X0WX0Hq8,q as s_snw0TywByhA,Q as s_y6nc4RA80e0};
